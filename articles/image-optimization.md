# Оптимизация изображений через gulp и средствами bitrix
Оптимизация изображений один из основных факторов быстродействия сайта.
Бывает, что на сайт загружены изображения с разрешением 5000x4000px и весом по 5-10 мб.
Случается даже, что эти изображение выводятся в блоках размером 600x400px.
Всё это точно понизит скорость загрузки сайта.
А вероятность ухода пользователся с сайта во многой степени зависит от времени его загрузки.
## gulp
Для разовой оптимизация изображений без изменения разрешения мы используем сборщик gulp.
Содержимое ```gulpfile.js```
```
var gulp = require('gulp'),
    imageminMozjpeg = require('imagemin-mozjpeg'),
    $ = require('gulp-load-plugins')();
    
gulp.task('imagemin', function() {
    return gulp.src(['../images/*.{png,jpg,jpeg,gif,JPG,JPEG}', '!img/icons/*'])
        .pipe($.plumber({errorHandler: $.notify.onError()}))
        .pipe($.imagemin({use: [imageminMozjpeg({quality: 85})]}))
        .pipe(gulp.dest('../images/'));
});
```
После выполнения ```gulp imagemin``` будут оптимизированы все изображенния в каталоге ```images``` с потерей качества в 15% (визуально неотличимы от оригинала).
Такой метод эффективен на сайтах, которые находятся на сопровождении, при этом разработаны другими компаниями.

Но такая оптимизация не решит проблему больших изображения в маленьких блоках, хотя Google PageSpeed в большинстве случаев будет доволен.

## ResizeImageGet
В CMS Bitrix существует встроенная функция обработки изображений ```CFile::ResizeImageGet()```
С её помощью в разных местах сайта можно выводить разные по размеру оптимизированные изображения.
Например, для главного слайдера сайта требуются изображения с разрешением 1920x1080. Тогда в шаблоне компонента достаточно вызвать:
```
$image = CFile::ResizeImageGet($arElement["DETAIL_PICTURE"], array("width" => 1920, "height" => 1080), BX_RESIZE_IMAGE_EXACT, false, false, false, QUALITY_IMG);
Где BX_RESIZE_IMAGE_EXACT - тип масштабирования, а QUALITY_IMG - качество изображения (мы используем 85).
```

И вывести:
```

<picture class="picture">
    <source media="(min-width: 1200px)" srcset="<?= $image["src"] ?>">
    *
    * Здесь могут быть source для других разрешений
    *
    <img class="picture__image" src="<?= $image["src"] ?>" srcset="<?= $image["src"] ?>">
</picture>
```

Таким образом на наших сайтах мы автоматически решаем проблему некорретнык по размеру и неоптимизированных изображений.
В админку сайта можно залить огромное изображение, при этом скорость сайта не пострадает и Google PageSpeed будет доволен.
Конечно, в целях экономии дискового пространства, нужно использовать встроенные методы битрикса, который в момент загрузки файла приведут его в нормальный размер.